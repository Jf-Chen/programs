程序流程

finalProgram.m包含getFeature函数
getFeature用于提取特征，针对单个60s信号某一导联，得出一组特征
特征暂定为平均RR间期，平均RR波峰，

test调用finalProgram,每一个测试数据调用一次
问：如何形成每个信号的训练集
答:查找REFERENCE.csv,首先查找三个标签，只要有其一符合就归类

问：如何进行交叉验证模块？
答：按顺序分5份，多余的归入最后一份，5可以是输入参数

形成特征集之前，需要先进行去噪，这里用中值滤波去除基线漂移
360Hz的使用200ms和600ms,500Hz的就使用144ms和432ms,就是一个72点一个216点
也许这个理论有出入，最后得到的频率未必是想要的
然后用检测斜率的方式分别检测RR间期
由于不同的Axxxx长度不同，所有一律使用平均信号作为特征，以确保维数一致

getFeature由detectR,detectQ，detectP组成，目前只用这三个信号
具体的做法有点忘了，应该是计算各点斜率，计算斜率的斜率，然后聚类得到拐点

问：如何获取R波峰
答：对slope进行聚类，得到的为1的部分，斜率较大，应该是QRS区段，具体的边界无法确定，
    图像中间的凹陷也难以解释，但是R波一定在这里
	
问：如何获取Q波谷
答：只能完整第走完流程了，不然不好去掉R波和Ron，Roff
    或者分别取出R左边的最低和R右边最低的，取完后画图验证下
	
问：如何使用getFeature，loadData,correctData和combineFeature
答：先加载数据得打data,然后correctData,然后getFeature,
    在finalProgram中多次重复得打多个collection(来自getFeature)
	由separate分离出信号
	由average加工原始特征，取得均值
	经过combineFeature得打由多个单个信号组成的训练集和测试集
	
问：如何完成交叉验证
答：在训练集中按照顺序地分成n份，每份数量取round(k/n)
    9000份数据应当每一个类型都能分成多份
	一共9中类型，最少的202份，最多的1098份
	
问：完整的程序流程如何
答：由finalProgram启动，执行newSeparate->loadData*7000
    ->combineFeature->classifers(oneclassifer*36)

问：getFeature可以得到单个信号的一系列特征，根据beats取均值
final中结合trainSet多次使用
    getFeature可以得到所有需要的collection，通过combineFeature得到
	训练模型所需要的训练矩阵

	
	
getFeature可能出错，去掉endP后排查试试，endP可以跳过错误但是需要知道错误原因
第1668个出错，第3261出错，新建一个testGetFeature进行测试

第6671数据明显有问题，画图可以看出，抛弃不用
问：如何抛弃数据
答：用同类型的文件代替

注：有问题的数据 4765,6671

多次重复finalProgram,在trainFeatures = combineFeature(trainSet,leadway,beats);
出现带有下标的赋值维度不匹配，判断为 getFeature没有问题，需要检测combineFeature

需要先检测一下oneSignalFeature


2018/5/17
顺序执行时出问题的文件：
1225,1670,1687

手动删除文件，有问题的文件用前20个首次出现同类型文件替代
类型1：A0002
类型2：A0003
类型3：A0039
类型4：A0011
类型5：A0001
类型6：A0047
类型7：A0005
类型8：A0008
类型9：A0021
如果检测时collection是0x0,就依据类型替换成检测以上文件，并且重新检测
简言之，每次getFeature后判断是否有维度为0的情况，如果有就把当前检测
文件的序号替换成以上的对应序号，监测起见，记录下被替换的文件和类型
计算一共替换的文件，之后人眼观察排除

未经过排查：214,290,1225,1372,1795,2255,2834,3176,4081,4148,4404,5904,6816
已经查看过上述的图像

现在需要的是形成训练集

按照心跳数建立建立训练模型，从1-10，记录下准确率和替换掉的文件

观察A0001.mat 觉得是无效数据，至少R波定位得不对

按照目前取R波的方法，无法识别出类型5的R波，参见A0001,A0015，A0022

画图看特点
类型1：2,16,20,29,30
类型2：3,4,7,9,17
类型3: 39,42,70,102,104
类型4: 11,18,44,57,74
类型5: 1,6,10,15,22,    43,51,53,66,68,69,78
类型6：47,49,55,62,80
类型7: 5,12,24,25,31
类型8: 8,13,14,33,40
类型9：21,32,34,36,46

问题文件：18,1,10,24,40
识别不正确文件：1,15,10,22,12(把T波当R波了)
slope聚类错误：1,15,22,24
slope聚类时对时错：34

观察A0034.mat发现，最终结果仍然受到kmeans分类影响
如何确认获得的keamns是自己想要的呢

对于74这样的文件，直接用
data=data';
% [IDX_slope1,cluster_center1]=kmeans(absslope,2,'emptyaction','drop');
[IDX_slope1,cluster_center1]=kmeans(data,2,'emptyaction','drop');
data=data';
效果反而更好

或许可以先用斜率做一次分类，在这基础上再用振幅做一次分类
这样操作似乎有些麻烦，简单的做法是取可能是‘R波’的点的均值
超过均值的5/6才是R波,2/3对于78不适用，
12希望数值高一些，78希望数值低一些
在聚类结果错误(把T波很尖锐)，而且T波比较高，(12)
大约是R波一半高度，的情况下，如何鉴别R波
又如何避免R波变化很大，过低的R波被筛选掉(49,78)
就有5/6吧,从区分T和R出发

对于1,10这样的文件，需要适当放宽Rl,Rr的左右边界
如果他们不是问题文件的话
似乎5类型的文件就是这样子的，需要调整下getFeature
看了43,51,53,66,68,69,78也是类型5的，比较正常，能正确识别出R波
5类型用43替代

仅仅使用RR,SP，PR难以保证准确率，加入T波波峰
若还不行，加入各波的交界

原来的特征不好用，需要整体特征而不是局部特征，可以使用RR间期，
分三步走
1. 取整体的最大值，最小值，平均值，方差，得一个1x4的特征
2. 整体的后一个减前一个，算出差值与均值的比例，取最值，比例的均值，方差(可能均值是无效的)
3. 取一个窗口，取窗口中的最大值最小值，滑动窗口，每次滑动一个单位
   算出整体的所有窗口的最值的平均，最值的方差等等
   
   
4beats准确率大多数都极高，用3beats验证一下，
3，4beats都是直接取的均值，加窗口按理说没有意义
6,7使用 所有窗口内max-min，计算该值的max,min，mean,var 作为特征输出
若仍准确，使用比例进行验证

special-4beats形成原因有些奇怪，是代码写错了形成的
错误之处在averageFeatures




